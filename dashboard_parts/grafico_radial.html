<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Radar Chart Avanzado</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    .axis {
      stroke: green;
      stroke-width: 1px;
    }
    .line {
      fill: none;
      stroke-width: 5px;
      opacity: 0.3;
      transition: all 0.2s;
    }
    .line-main {
      opacity: 0.6;
    }
    .highlight {
      opacity: 1 !important;
      stroke-width: 3px !important;
    }
    .legend rect {
      stroke: none;
    }
    .legend-highlight text {
      font-weight: bold;
    }
    .tick-label {
      font-size: 10px;
      fill: #333;
    }
  </style>
</head>
<body>
  <svg id="chart" width="500" height="250"></svg>

  <script>

    const attributes = ["A", "B", "C", "D", "E"];

    const width = 500;
    const height = 250;
    const radius = 100;
    const center = { x: (width / 2) - 120, y: height / 2 };
    const angleSlice = (2 * Math.PI) / attributes.length;

    

    // Atributos con valores Z-score (ejes con escalas diferentes)
    const scales = {
      A: d3.scaleLinear().domain([-2, 2]).range([0, radius]),
      B: d3.scaleLinear().domain([-1, 3]).range([0, radius]),
      C: d3.scaleLinear().domain([-3, 3]).range([0, radius]),
      D: d3.scaleLinear().domain([0, 1.5]).range([0, radius]),
      E: d3.scaleLinear().domain([-2, 1]).range([0, radius])
    };

    // Dataset con valores reales
    const data = [
      { name: "Grupo Principal", values: { A: 1.2, B: 2.0, C: -1.0, D: 1.2, E: 0.5 }, color: "green" },
      { name: "Comparador 1",   values: { A: 0.5, B: 1.0, C: 0.0, D: 0.7, E: -0.5 }, color: "orange" },
      { name: "Comparador 2",   values: { A: -1.5, B: 2.8, C: 1.0, D: 0.3, E: 0.8 }, color: "blue" },
      { name: "Comparador 3",   values: { A: -0.2, B: 0.5, C: -2.0, D: 0.9, E: -1.0 }, color: "purple" },
      { name: "Comparador 4",   values: { A: 1.8, B: 2.5, C: -0.5, D: 1.5, E: 1.0 }, color: "red" }
    ];

    

    const svg = d3.select("#chart")
      .attr("width", width)
      .attr("height", height);

    // Ejes y ticks por atributo
    attributes.forEach((attr, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const scale = scales[attr];

      // Línea del eje
      const lineX = center.x + Math.cos(angle) * radius;
      const lineY = center.y + Math.sin(angle) * radius;
      svg.append("line")
        .attr("x1", center.x)
        .attr("y1", center.y)
        .attr("x2", lineX)
        .attr("y2", lineY)
        .attr("class", "axis");

      // Etiqueta del atributo
      const labelX = center.x + Math.cos(angle) * (radius + 20);
      const labelY = center.y + Math.sin(angle) * (radius + 20);
      svg.append("text")
        .attr("x", labelX)
        .attr("y", labelY)
        .attr("text-anchor", "middle")
        .attr("dominant-baseline", "central")
        .text(attr);

      // Ticks con valores
      const tickValues = scale.ticks(5);
      tickValues.forEach(val => {
        const dist = scale(val);
        const x = center.x + Math.cos(angle) * dist;
        const y = center.y + Math.sin(angle) * dist;

        svg.append("circle")
          .attr("cx", x)
          .attr("cy", y)
          .attr("r", 2)
          .attr("fill", "#888");

        svg.append("text")
          .attr("x", x)
          .attr("y", y)
          .attr("dy", "-0.4em")
          .attr("text-anchor", "middle")
          .attr("class", "tick-label")
          .text(val.toFixed(1));
      });
    });

    // Función para convertir valores a coordenadas polares
    function getPathCoords(entry) {
      return attributes.map((attr, i) => {
        const angle = angleSlice * i - Math.PI / 2;
        const r = scales[attr](entry.values[attr]);
        return [
          center.x + Math.cos(angle) * r,
          center.y + Math.sin(angle) * r
        ];
      });
    }

    // Dibujar líneas
    const line = d3.line().curve(d3.curveLinearClosed);

    const group = svg.append("g");
    data.forEach((entry, idx) => {
      const coords = getPathCoords(entry);

      const path = group.append("path")
        .attr("d", line(coords))
        .attr("stroke", entry.color)
        .attr("stroke-width", 30)
        .attr("fill", "none")
        .attr("class", entry.name === "Grupo Principal" ? "line line-main" : "line")
        .attr("data-idx", idx)
        .on("mouseover", function () {
          d3.select(this).classed("highlight", true);
          d3.select(`#legend-${idx}`).classed("legend-highlight", true);
        })
        .on("mouseout", function () {
          d3.select(this).classed("highlight", false);
          d3.select(`#legend-${idx}`).classed("legend-highlight", false);
        });

      if (entry.name !== "Grupo Principal") {
        // Línea en gris por defecto
        path.attr("stroke", "gray");
      }
    });

    // Leyenda con colores reales
    const legend = svg.append("g")
      .attr("class", "legend")
      .attr("transform", "translate(270, 115)");

    data.forEach((entry, idx) => {
      const item = legend.append("g")
        .attr("transform", `translate(0, ${idx * 20})`)
        .attr("id", `legend-${idx}`);

      item.append("rect")
        .attr("width", 12)
        .attr("height", 12)
        .attr("fill", entry.color);

      item.append("text")
        .attr("x", 18)
        .attr("y", 10)
        .text(entry.name);
    });
  </script>
</body>
</html>